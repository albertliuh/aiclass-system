<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ¨çº¿ç­”é¢˜è€ƒè¯•ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="app">
        <!-- ä¸»é¡µé¢ -->
        <div v-if="currentPage === 'home'" class="page home-page">
            <div class="container">
                <h1 class="title">åœ¨çº¿ç­”é¢˜è€ƒè¯•ç³»ç»Ÿ</h1>

                <div class="card">
                    <h2>é¢˜åº“ç®¡ç†</h2>
                    <div class="file-input-wrapper">
                        <input type="file" id="csvFile" @change="handleFileSelect" accept=".csv" hidden>
                        <label for="csvFile" class="btn btn-primary">
                            ğŸ“ å¯¼å…¥é¢˜åº“ (CSV)
                        </label>

                        <input type="file" id="xlsxFile" @change="handleXLSXFileSelect" accept=".xlsx,.xls" hidden>
                        <label for="xlsxFile" class="btn btn-success">
                            ğŸ“Š å¯¼å…¥é¢˜åº“ (XLSX)
                        </label>
                    </div>
                    <p v-if="questions.length > 0" class="info-text">
                        å½“å‰é¢˜åº“: {{ questions.length }} é“é¢˜ç›®
                        <span v-if="hasColoredQuestions" class="colored-tag">å«é¢œè‰²æ ‡è®°</span>
                    </p>
                    <div v-if="questions.length > 0 || examHistory.length > 0" class="clear-section">
                        <button @click="clearAllData" class="btn btn-danger">
                            ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®
                        </button>
                        <p class="warning-text">æ¸…ç©ºé¢˜åº“ã€ç­”é¢˜è®°å½•ã€ç»Ÿè®¡ä¿¡æ¯ç­‰æ‰€æœ‰æ•°æ®</p>
                    </div>
                </div>

                <div class="card" v-if="questions.length > 0">
                    <h2>å¼€å§‹è€ƒè¯•</h2>
                    <p class="info-text">å¯ç”¨é¢˜ç›®: {{ availableQuestions.length }} é“</p>
                    <button @click="startExam" class="btn btn-success btn-large" :disabled="availableQuestions.length === 0">
                        ğŸ¯ å¼€å§‹è€ƒè¯•
                    </button>
                    <p v-if="availableQuestions.length === 0" class="warning-text">
                        æ‰€æœ‰é¢˜ç›®éƒ½å·²è¿ç»­ç­”å¯¹{{ consecutiveCorrectThreshold }}æ¬¡ï¼Œæ— å¯ç”¨é¢˜ç›®
                    </p>
                </div>

                <div class="card" v-if="questions.length > 0">
                    <h2>å¤ä¹ æ¨¡å¼</h2>
                    <p class="info-text">æŸ¥çœ‹æ‰€æœ‰é¢˜ç›®å’Œæ­£ç¡®ç­”æ¡ˆï¼Œæ–¹ä¾¿å¤ä¹ è®°å¿†</p>
                    <button @click="startReview" class="btn btn-info btn-large">
                        ğŸ“š è¿›å…¥å¤ä¹ æ¨¡å¼
                    </button>
                </div>

                <div class="card" v-if="hasColoredQuestions">
                    <h2>å½©è‰²å¤ä¹ æ¨¡å¼</h2>
                    <p class="info-text">æŸ¥çœ‹å¸¦é¢œè‰²æ ‡è®°çš„é¢˜ç›®é€‰é¡¹ï¼ˆXLSXæ ¼å¼ï¼‰</p>
                    <button @click="startColoredReview" class="btn btn-success btn-large">
                        ğŸ¨ è¿›å…¥å½©è‰²å¤ä¹ æ¨¡å¼
                    </button>
                </div>

                <div class="card" v-if="examHistory.length > 0">
                    <h2>å†å²æˆç»©</h2>
                    <div class="history-list">
                        <div v-for="(record, index) in examHistory" :key="index" class="history-item">
                            <div class="history-time">{{ formatTime(record.startTime) }}</div>
                            <div class="history-score">
                                æ­£ç¡®: {{ record.score.correct }} / {{ record.score.total }}
                                ({{ record.score.accuracy }})
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card settings-card">
                    <h2>è®¾ç½®</h2>
                    <div class="setting-item">
                        <label>è¿ç»­ç­”å¯¹æ¬¡æ•°é˜ˆå€¼:</label>
                        <input type="number" v-model.number="consecutiveCorrectThreshold" min="1" max="10" class="input-number">
                        <span class="setting-desc">é¢˜ç›®è¿ç»­ç­”å¯¹æ­¤æ¬¡æ•°åå°†ä¸å†å‡ºç°</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- è€ƒè¯•é¡µé¢ -->
        <div v-if="currentPage === 'exam'" class="page exam-page">
            <div class="exam-header">
                <div class="progress-bar">
                    <div class="progress-fill" :style="{width: progressPercent + '%'}"></div>
                </div>
                <div class="exam-info">
                    <span>é¢˜å·: {{ currentQuestionIndex + 1 }} / {{ currentExamQuestions.length }}</span>
                    <span>æœ¬æ¬¡æ­£ç¡®: <span class="correct-count">{{ currentExamCorrect }}</span></span>
                    <span>æœ¬æ¬¡é”™è¯¯: <span class="incorrect-count">{{ currentExamIncorrect }}</span></span>
                </div>
            </div>

            <div class="container">
                <!-- ä¸Šä¸€é¢˜ç­”æ¡ˆåé¦ˆï¼ˆç´§å‡‘æ˜¾ç¤ºï¼‰ -->
                <div v-if="lastAnswerFeedback" class="answer-feedback-compact">
                    <div :class="['feedback-header', lastAnswerFeedback.isCorrect ? 'correct' : 'incorrect']">
                        <span class="feedback-icon">{{ lastAnswerFeedback.isCorrect ? 'âœ“' : 'âœ—' }}</span>
                        <span class="feedback-text">
                            ç¬¬{{ lastAnswerFeedback.questionIndex }}é¢˜ {{ lastAnswerFeedback.isCorrect ? 'æ­£ç¡®' : 'é”™è¯¯' }}
                        </span>
                        <span class="feedback-answer">
                            ä½ çš„ç­”æ¡ˆ: {{ lastAnswerFeedback.userAnswer }} | æ­£ç¡®ç­”æ¡ˆ: {{ lastAnswerFeedback.correctAnswer }}
                        </span>
                    </div>
                </div>

                <!-- å½“å‰é¢˜ç›® -->
                <div class="question-card">
                    <div class="question-type">{{ currentQuestion.type }}</div>
                    <div class="question-text" v-html="highlightText(currentQuestion.question)"></div>

                    <!-- å•é€‰é¢˜å’Œåˆ¤æ–­é¢˜ -->
                    <div v-if="currentQuestion.type === 'å•é€‰' || currentQuestion.type === 'åˆ¤æ–­'" class="options">
                        <label v-for="(value, key) in currentQuestion.options" :key="key" class="option-label">
                            <input type="radio" :name="'q' + currentQuestion.id" :value="key" v-model="userAnswer">
                            <span class="option-text">{{ key }}. {{ value }}</span>
                        </label>
                    </div>

                    <!-- å¤šé€‰é¢˜ -->
                    <div v-if="currentQuestion.type === 'å¤šé€‰'" class="options">
                        <label v-for="(value, key) in currentQuestion.options" :key="key" class="option-label">
                            <input type="checkbox" :value="key" v-model="userAnswer">
                            <span class="option-text">{{ key }}. {{ value }}</span>
                        </label>
                    </div>

                    <div class="exam-actions">
                        <button @click="previousQuestion" class="btn btn-secondary" :disabled="currentQuestionIndex === 0">
                            â¬… ä¸Šä¸€é¢˜
                        </button>
                        <button @click="showOverview" class="btn btn-info">
                            ğŸ“‹ æ€»è§ˆ
                        </button>
                        <button @click="submitAnswer" class="btn btn-primary" :disabled="!hasAnswer">
                            ä¸‹ä¸€é¢˜ â¡
                        </button>
                        <button @click="finishExam" class="btn btn-warning">
                            âœ… äº¤å·
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ€»è§ˆé¡µé¢ -->
        <div v-if="currentPage === 'overview'" class="page overview-page">
            <div class="container">
                <h2>é¢˜ç›®æ€»è§ˆ</h2>
                <div class="overview-legend">
                    <span class="legend-item"><span class="dot unanswered"></span> æœªç­”é¢˜</span>
                    <span class="legend-item"><span class="dot correct"></span> ç­”å¯¹</span>
                    <span class="legend-item"><span class="dot incorrect"></span> ç­”é”™</span>
                </div>
                <div class="question-grid">
                    <div v-for="(q, index) in currentExamQuestions" :key="index"
                         :class="['question-number', getQuestionStatus(index)]"
                         @click="jumpToQuestion(index)">
                        {{ index + 1 }}
                    </div>
                </div>
                <button @click="backToExam" class="btn btn-primary btn-large">
                    è¿”å›ç­”é¢˜
                </button>
            </div>
        </div>

        <!-- æˆç»©æŠ¥å‘Šé¡µé¢ -->
        <div v-if="currentPage === 'report'" class="page report-page">
            <div class="container">
                <h1>è€ƒè¯•æˆç»©æŠ¥å‘Š</h1>
                <div class="score-card">
                    <div class="score-big">{{ currentExamScore.accuracy }}</div>
                    <div class="score-label">æ­£ç¡®ç‡</div>
                </div>
                <div class="score-details">
                    <div class="score-item">
                        <div class="score-value">{{ currentExamScore.total }}</div>
                        <div class="score-label">æ€»é¢˜æ•°</div>
                    </div>
                    <div class="score-item correct">
                        <div class="score-value">{{ currentExamScore.correct }}</div>
                        <div class="score-label">ç­”å¯¹</div>
                    </div>
                    <div class="score-item incorrect">
                        <div class="score-value">{{ currentExamScore.incorrect }}</div>
                        <div class="score-label">ç­”é”™</div>
                    </div>
                </div>

                <div class="answer-review">
                    <h3>ç­”é¢˜è¯¦æƒ…</h3>
                    <div v-for="(answer, index) in currentExamAnswers" :key="index" class="review-item">
                        <div class="review-header">
                            <span class="review-number">ç¬¬{{ index + 1 }}é¢˜</span>
                            <span :class="['review-result', answer.isCorrect ? 'correct' : 'incorrect']">
                                {{ answer.isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯' }}
                            </span>
                        </div>
                        <div class="review-question" v-html="highlightText(answer.question)"></div>
                        <div v-if="!answer.isCorrect" class="review-answers">
                            <p>ä½ çš„ç­”æ¡ˆ: {{ answer.userAnswer }}</p>
                            <p>æ­£ç¡®ç­”æ¡ˆ: {{ answer.correctAnswer }}</p>
                        </div>
                    </div>
                </div>

                <div class="report-actions">
                    <button @click="backToHome" class="btn btn-primary btn-large">
                        è¿”å›é¦–é¡µ
                    </button>
                    <button @click="startExam" class="btn btn-success btn-large">
                        å†è€ƒä¸€æ¬¡
                    </button>
                </div>
            </div>
        </div>

        <!-- å¤ä¹ æ¨¡å¼é¡µé¢ -->
        <div v-if="currentPage === 'review'" class="page review-page">
            <div class="review-header">
                <div class="container">
                    <div class="review-title-bar">
                        <h1>å¤ä¹ æ¨¡å¼</h1>
                        <button @click="backToHome" class="btn btn-secondary">
                            â† è¿”å›é¦–é¡µ
                        </button>
                    </div>
                    <div class="review-controls">
                        <div class="jump-controls">
                            <label>è·³è½¬åˆ°é¢˜å·ï¼š</label>
                            <input type="number" v-model.number="jumpToQuestionNumber" min="1" :max="questions.length" class="input-number">
                            <button @click="jumpToQuestionInReview" class="btn btn-primary">
                                è·³è½¬
                            </button>
                        </div>
                        <div class="review-info">
                            å…± {{ questions.length }} é¢˜
                        </div>
                    </div>
                </div>
            </div>

            <div class="container review-container">
                <!-- æ‰€æœ‰é¢˜ç›®è¿ç»­æ˜¾ç¤º -->
                <div v-for="(q, index) in questions" :key="q.id" :id="'review-q-' + (index + 1)" class="review-question-card">
                    <div class="review-question-header">
                        <span class="review-question-number">ç¬¬ {{ index + 1 }} é¢˜</span>
                        <span class="review-question-type">{{ q.type }}</span>
                    </div>

                    <div class="review-question-text" v-html="highlightText(q.question)"></div>

                    <div class="review-options">
                        <div v-for="(value, key) in q.options" :key="key"
                             :class="['review-option', isCorrectOption(q, key) ? 'correct-option' : '']">
                            <span class="option-key">{{ key }}</span>
                            <span class="option-value">{{ value }}</span>
                            <span v-if="isCorrectOption(q, key)" class="correct-badge">âœ“ æ­£ç¡®ç­”æ¡ˆ</span>
                        </div>
                    </div>

                    <div class="review-answer">
                        <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong>
                        <span class="answer-text">{{ q.answer }}</span>
                    </div>

                    <div v-if="q.statistics.totalAttempts > 0" class="review-stats">
                        <span>ç­”é¢˜æ¬¡æ•°: {{ q.statistics.totalAttempts }}</span>
                        <span>æ­£ç¡®æ¬¡æ•°: {{ q.statistics.correctAttempts }}</span>
                        <span>è¿ç»­ç­”å¯¹: {{ q.statistics.consecutiveCorrect }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- å½©è‰²å¤ä¹ æ¨¡å¼é¡µé¢ -->
        <div v-if="currentPage === 'colored-review'" class="page colored-review-page">
            <div class="review-header">
                <div class="container">
                    <div class="review-title-bar">
                        <h1>å½©è‰²å¤ä¹ æ¨¡å¼</h1>
                        <button @click="backToHome" class="btn btn-secondary">
                            â† è¿”å›é¦–é¡µ
                        </button>
                    </div>
                    <div class="review-controls">
                        <div class="jump-controls">
                            <label>è·³è½¬åˆ°é¢˜å·ï¼š</label>
                            <input type="number" v-model.number="coloredJumpToQuestionNumber" min="1" :max="coloredQuestions.length" class="input-number">
                            <button @click="jumpToColoredQuestion" class="btn btn-primary">
                                è·³è½¬
                            </button>
                        </div>
                        <div class="review-info">
                            å…± {{ coloredQuestions.length }} é¢˜
                        </div>
                    </div>
                </div>
            </div>

            <div class="container review-container">
                <!-- æ‰€æœ‰å¸¦é¢œè‰²çš„é¢˜ç›®è¿ç»­æ˜¾ç¤º -->
                <div v-for="(q, index) in coloredQuestions" :key="q.id" :id="'colored-q-' + (index + 1)" class="colored-question-card">
                    <div class="colored-question-header">
                        <span class="colored-question-number">ç¬¬ {{ index + 1 }} é¢˜</span>
                        <span class="colored-question-type">{{ q.type }}</span>
                    </div>

                    <div class="colored-question-text" v-html="highlightText(q.question)"></div>

                    <div class="colored-options">
                        <div v-for="(value, key) in q.options" :key="key"
                             class="colored-option"
                             :style="{ backgroundColor: q.optionColors[key] || 'transparent' }">
                            <span class="option-key">{{ key }}</span>
                            <span class="option-value">{{ value }}</span>
                        </div>
                    </div>

                    <div class="colored-answer">
                        <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong>
                        <span class="answer-text">{{ q.answer }}</span>
                    </div>

                    <div v-if="q.statistics.totalAttempts > 0" class="colored-stats">
                        <span>ç­”é¢˜æ¬¡æ•°: {{ q.statistics.totalAttempts }}</span>
                        <span>æ­£ç¡®æ¬¡æ•°: {{ q.statistics.correctAttempts }}</span>
                        <span>è¿ç»­ç­”å¯¹: {{ q.statistics.consecutiveCorrect }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä½¿ç”¨Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- SheetJS ç”¨äºè§£æ xlsx æ–‡ä»¶ -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
